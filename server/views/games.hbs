{{!< main}}
<div class="row contentbox">
  <div class="large-12 columns">
    <h3 style="float: left; width: 50%">Mine spill</h3>
    <br>
    <input type="submit" value="Nytt spill" class="button small" style="float: right;" />
    <div id="error" {{#if error}} class="error" {{/if}}>{{error}}</div>
    <table class="large-12 columns">
      <thead>
          <tr>
              <td class="top-left">Spill-id</td>
              <td>Navn</td>
              <td>Laget</td>
              <td></td>
          </tr>
      </thead>
      <tbody>
        {{#each games}}
          <tr>
            <td id="game-id">
              {{gameId}}
            </td>
            <td>
              <div class="control-group">
                <div class="control-label" style="float: left; width: 70%">
                  {{name}}
                </div>
                <input type="text" value="{{name}}" class="edit-input" style="display: none; float: left; width: 70%;" />
                <div class="controls" style="float: right; width: 30% text-align: right;">
                  <a class="editSave" href="#">Rediger</a>
                </div>
              </div>
            </td>
            <td>
              {{datetimeformat created}}
            </td>
            <td>
              <a href="/game/{{gameId}}">Åpne <img src="/gfx/action.png" width=16 />
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</div>

<div id="dialog-form" title="Nytt spill">
  <form action="/game" method="POST" name="new-game">
    <label>Navn på nytt spill:</label>
    <input type="text" name="name" id="name" />
  </form>
</div>

<script type="text/javascript">

$(document).ready(function() {

  $( '#dialog-form' ).dialog({
    autoOpen: false,
    height: 300,
    width: 300,
    modal: true,
    buttons: {
      'OK': function (){
        document.forms['new-game'].submit();
      },
      'Avbryt': function (){
        $( this ).dialog( 'close' );
      }
    },
  });

  $('input.button').click(function () {
    $( '#dialog-form' ).dialog( 'open' );
  });

  $('a.editSave').click(function () {
    var outerDiv = $(this).parent().parent();
    
    var editSave = this;

    
    if (editSave.innerHTML == 'Rediger') {
      editSave.innerHTML = 'Lagre';
      outerDiv.find('.control-label').hide();
      outerDiv.find('input[type="text"]').show().focus();
    } else {
      editSave.innerHTML = 'Rediger';
      outerDiv.find('.control-label').show();
      outerDiv.find('input[type="text"]').hide();

      var input = outerDiv.find('input');
      var row = outerDiv.parent().parent();
      var gameId = parseInt(row.find('#game-id').html());

      $.ajax({
        type: 'POST', 
        url: '/game/' + gameId, 
        dataType:"json", 
        data: {
          name: input.val()
        },
        success: function ( response ){ 
          if (response.redirect) {
            window.location.href = response.redirect;
          } else if ( response.error ) {
            var errorDiv = $('#error');
            errorDiv.addClass('error');
            errorDiv.html(response.error);
          } else {                
            location.reload();
          }
        }, 
        error: function( xhr, textStatus, errorThrown ) { 
          alert('Error!  Status = ' + xhr.status); 
          console.log('textStatus', textStatus);
          console.log('errorThrown', errorThrown);
        } 
      });
    }
  });
});
</script>